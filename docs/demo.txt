README.mdの[AKSクラスタの作成]まで完了している事

(オプショナル)
Dashboard(k8sのUI)を表示
https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/
手順
https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/creating-sample-user.md

kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.6.1/aio/deploy/recommended.yaml
kubectl apply -f yaml/dashboard-adminuser.yaml
kubectl -n kubernetes-dashboard create token admin-user
kubectl proxy
open http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/


(オプショナル)
Lens 
https://k8slens.dev/  
WSL2環境の場合、https://backpackkevin.com/lens-ide-working-with-wsl-2/

(オプショナル Lensにモニタ結果が表示されるようになる)
Prometheus
kubectl create ns monitoring
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo add stable https://charts.helm.sh/stable
helm repo update
helm install prometheus-stack prometheus-community/kube-prometheus-stack -n monitoring

-------------------------------
kubectl create namespace iris-ns
(オプション)デフォルトのネームスペースを指定
kubectl config set-context $(kubectl config current-context) --namespace=iris-ns

Pod
-------------------------------
kubectl run iris --image=containers.intersystems.com/intersystems/iris-community:2022.1.0.209.0 -- "--check-caps false"
(2022.2以降はcheck-caps引数不要)
kubectl describe pod iris
kubectl logs iris
kubectl exec -ti iris -- bash
kubectl exec -ti iris -- iris session iris
kubectl delete pod iris

StatefulSet
-------------------------------
kubectl apply -f yaml/iris-ssd-sc-aks.yaml
kubectl apply -f yaml/iris-configmap-cpf.yaml
kubectl apply -f yaml/iris-statefulset.yml
kubectl exec -ti iris-0 -- iris session iris
kubectl get svc
  NAME      TYPE           CLUSTER-IP    EXTERNAL-IP     PORT(S)           AGE
  my-iris   LoadBalancer   10.0.239.90   20.188.20.225   52773:30699/TCP   16s
  http://EXTERNAL-IP:52773/csp/sys/%25CSP.Portal.Home.zen
replicas: 1->2
kubectl apply -f yaml/iris-statefulset.yml
kubectl delete -f yaml/iris-statefulset.yml
kubectl get pvc
kubectl delete pvc -l app=my-iris

IKO
-------------------------------
shell/aks-prep-iris-cluster.sh
helm install intersystems chart/iris-operator --wait
kubectl apply -f yaml/iris-iko.yaml
kubectl get statefulset -o wide
kubectl get iriscluster   (runningを確認)
kubectl get pvc
kubectl get svc
  http://EXTERNAL:52773/csp/sys/%25CSP.Portal.Home.zen
  ミラーモニタ(プライマリのメンバ名がIRISMIRROR1Aであること)、シャード構成を確認
kubectl exec -ti iris-vs2021-data-0-0 -- iris session iris -U IRISDM
IRISDM> f i=1:1:1000 s ^a(i)=i

kubectl exec -ti iris-vs2021-data-0-1 -- iris session iris -U IRISDM
IRISDM> zw ^a
IRISDM>s ^a=1

S ^a=1
^
<PROTECT> ^a,/irissys/data/IRIS/mgr/irisdm/

kubectl delete pod iris-vs2021-data-0-0
(BackupがPrimaryに切り替わる)
kubectl exec -ti iris-vs2021-data-0-1 -- iris session iris -U IRISDM
IRISDM> s ^a=1

(削除したpodは自動回復し、やがてBackupメンバで起動する)
kubectl exec -ti iris-vs2021-data-0-0 -- iris session iris -U IRISDM
IRISDM> s ^a=1
S ^a=1
^
<PROTECT> ^a,/irissys/data/IRIS/mgr/irisdm/
IRISDM>

kubectl delete -f yaml/iris-iko.yaml
kubectl delete pvc -l intersystems.com/name=iris-vs2021

ミラーバックアップの管理ポータルへのアクセス方法
kubectl port-forward iris-vs2021-data-0-1 9999:52773

